/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.5.1/samples
 */
// build.gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.7'
    id 'io.spring.dependency-management' version '1.1.0'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation('org.springframework.boot:spring-boot-starter-web')
    implementation('org.springframework.boot:spring-boot-starter-data-redis')
    javaAgent('software.amazon.opentelemetry:aws-opentelemetry-agent:1.30.0') // ADOT Java エージェントのダウンロード
}

// ダウンロードした ADOT Java エージェントをコピー
task agentLibs(type: Copy) {
    from configurations.javaAgent.singleFile
    into layout.buildDirectory.dir('libs')
    rename 'aws-opentelemetry-agent-.*\\.jar', 'aws-opentelemetry-agent.jar'
}

// アプリケーションの jar をビルドした際に ADOT の jar も取得する
bootJar {
    dependsOn agentLibs
}